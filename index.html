<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>ScreenUTC</title>
		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/beige.css" id="theme">
	</head>
	<body>

		<div style="width: 100%; height: 100%; display: none; z-index: 10000; background-color: #8EaFcE; position: absolute;" id="overeverest">
			<div style="top:2%; right:53%; z-index: 10002; position: absolute; font-size: 200%;"><h2>Objectif: 8848 m</h2></div>
			<div style="top:25%; right:10%; z-index: 10003; position: absolute; font-size: 200%;"><h2>Gravis: <span id="counter">0</span> m</h2></div>
			<div style="width: 100%; height: 100%; z-index: 10001; position: absolute;"><img src="img/fond-everest.png" style="width: 100%; height: 100%;"/></div>
			<div id="everest_back" style="background-color: #83a4c3; background: url('img/douche.png'); background-repeat:repeat; background-size:50px 50px; margin-top:7.5%; height: 61.5%; width: 100%; margin-right:auto; margin-left: auto; border-width:1px; ">
				<div id="everest_front" style="background-color: #83a4c3; height: 100%; margin-right:auto; margin-left: auto;"></div>
			</div>
		</div>
		<div style="width: 100%; height: 100%; display: none; z-index: 10000;  position: absolute;" id="video_fullscreen">
		    <video id="player" style="width: 100%; height: 100%;" src="img/video1.mov"></video>
		</div>
		
		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides" >
				<section data-autoslide="4500" data-background="img/fond.jpg">
					<h3>Welcome to the PIC 1800 !</h3>
					<p>
						<video data-autoplay src="img/video1.mov"></video>
					</p>
				</section>

				<section data-background="img/fond.jpg">
					<div style="top:-380px; right: -200px; position:absolute; "><h2>Twitter, hashtag #PicassoUTC</h2></div>
					<section data-autoslide="10000" data-background="img/fond.jpg">
						<p>Envoyez vos messages avec le hashtag #PicassoUTC, voici les 10 derniers messages !</p>
					</section>
					<section style="height: 700px;">
					<table border="0" style="padding-top: 30px;">
					    <tr>
						<td style="text-align:center;">
						    <span id="username"></span> <br />
						    <!-- <img id="profile" width="96px" height="96px" style="border: 0px;" /> <br /> -->
						    @<span id="login"></span>
					    </td>
					    <td style="text-align: center; vertical-align: middle;">
					        <span id="texte"></span></td>
						</tr>
					</table>
					<img id="twittimage" height="480px" style="border: 0px; position:aboslute;" />
					</section>
				</section>

				<section></section>
				
				<section data-autoslide="4500" data-background="img/fond.jpg">
					<h3>#MaBranche Represent !</h3>
					<p>Vote pour ta branche en commandant au bar, (1cts€/vote), les bénéfices seront reversés à une association humanitaire</p>
					<table border=1 width="100%">
				        <tr><td>#1</td><td><span id="rk_br1" /></td><td><span id="rk_v1" /> Votes</td></tr>
				        <tr><td>#2</td><td><span id="rk_br2" /></td><td><span id="rk_v2" /> Votes</td></tr>
				        <tr><td>#3</td><td><span id="rk_br3" /></td><td><span id="rk_v3" /> Votes</td></tr>
				        <tr><td>#4</td><td><span id="rk_br4" /></td><td><span id="rk_v4" /> Votes</td></tr>
				        <tr><td>#5</td><td><span id="rk_br5" /></td><td><span id="rk_v5" /> Votes</td></tr>
				        <tr><td>#6</td><td><span id="rk_br6" /></td><td><span id="rk_v6" /> Votes</td></tr>
				        <tr><td>#7</td><td><span id="rk_br7" /></td><td><span id="rk_v7" /> Votes</td></tr>
					</table>
				</section>
			</div>

		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: true,
				history: false,
				center: true, 
				loop: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [/*
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				*/]
			});
			var val, payutc, tweets;
			
			var videos = [
			    "img/video1.mov",
			    "img/video1.mov",
			    "img/video1.mov"
			];
			
			var videos_time = [
			    1000, 2000, 3000   
			];
			
			var video_count = 0;

			function read_tweet() {
				if(tweets.length == 0) { Reveal.next(); return; }
				var tweet = tweets.splice(0,1)[0];
				$("#username").text(tweet.user.name);
				$("#login").text(tweet.user.screen_name);
				$("#texte").text(tweet.text);
				$("#profile").attr("src", tweet.user.profile_image_url);
				if(tweet.entities.media && tweet.entities.media.length > 0) {
				    $("#twittimage").attr("src", tweet.entities.media[0].media_url);
				    $("#twittimage").show();
				} else {
				    $("#twittimage").hide();
				}
				setTimeout(read_tweet, 4000);
			}

			Reveal.addEventListener( 'slidechanged', function( event ) {
				if(event.indexh == 1 && event.indexv == 0) {
					tweets = [];
					$.get("twitter.php", function( data ) {
					   for(var i=data.statuses.length-1; i>=0; i--) {
					   		tweets.push(data.statuses[i]);
					   }
					   setTimeout(function() {
					    read_tweet();
					    Reveal.next();
					   }, 1500);
					}, "json");

					$.get( "payutc.php", function( data ) {
					   payutc = data;
					   console.log(payutc);
					   val=parseInt(payutc.total);
					   var table = [
					        ["GI", payutc.GI],
					        ["TC", payutc.TC],
					        ["GSU", payutc.GSU],
					        ["GM", payutc.GM],
					        ["GSM", payutc.GSM],
					        ["GB", payutc.GB],
					        ["GP", payutc.GP]
					   ];

                        table.sort(function(a, b) {
                            a = a[1];
                            b = b[1];

                            return a < b ? -1 : (a > b ? 1 : 0);
                        });
					   for(var i=0; i<table.length; i++) {
					     $("#rk_br"+(i+1)).text(table[i][0]);
					     $("#rk_v"+(i+1)).text(table[i][1]);
					   }
					}, "json");
				}

				if(event.indexh == 2) {
					$("#overeverest").show();
				    $("#everest_front").height("100%");
				    $('#counter').text(Math.ceil(0)/100);
				    setTimeout(function() { 
				    	$("#everest_front").animate({height: (100-(val/8000))+"%", easing: "ease-in"}, 5000); 
						jQuery({someValue: 0}).animate({someValue: val}, {
							duration: 5000,
							easing:'swing', // can be anything
							step: function() { // called on every step
								// Update the element's text with rounded-up value:
								$('#counter').text(Math.ceil(this.someValue)/100);
							},
							complete: function() {
								$('#counter').text(Math.ceil(val)/100);
							}
						});
					}, 1000);
					setTimeout(function() {
					    // Fin du compteur
					    $("#overeverest").hide();
					    $("#video_fullscreen").show();
					    $("#player").attr("src", videos[video_count]);
					    var v = document.getElementById("player");
					    v.play();
					    setTimeout(function() {
					        $("#video_fullscreen").hide();
					        Reveal.next();
					        video_count = (video_count + 1) % videos.length;
					    }, videos_time[video_count]);
					}, 4500);
				}

			});

			// Petit bug au premier affichage de la première slide, l'autoplay de reveal marche pas...
			// Du coup on le fait a la main.
			var v = document.getElementsByTagName("video")[0];
			v.play();
		</script>
	</body>
</html>
